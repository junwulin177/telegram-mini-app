<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://telegram.org/js/games.js"></script>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/vite.svg" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
        />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vite + React + TS</title>
            <style>
        body {
            background-color: black;
            color: white;
        }
    </style>
    </head>
<body>
    <script src="https://telegram.org/js/games.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://telegram.org/js/telegram-passport.js"></script>
    <h1>我的第一个标题!！!！</h1>
    <p>我的第一个段落。</p>
    <pre id="log"></pre>
<script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="Junwu17777_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
<script type="text/javascript">
  function onTelegramAuth(user) {
    alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
  }
</script>
<div id="telegram_passport_auth"></div>
<script>
Telegram.Passport.createAuthButton('telegram_passport_auth', {
  bot_id: 6688523680, // 这里填入你的 Bot ID
  payload: 'payload',
  scope:[
          { type: 'id_document', selfie: true },
          { type: 'address_document' },
          { type: 'phone_number' },
          { type: 'email' }
        ],
  public_key: `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqCt3o4XtrbynIGE/RAnx
TPIWnf/A+ILEpfGl+8uHDjvvurxqg/rNtV36XYyjuLlg1+tms6gVNZc49Kucww8u
Br7qoJE6U6gJIETlyiXll/fzc1VEooJ0SEaSi602NZYV8it54kZfBVK0QOF3iL0A
0Mx3vhI5d9lpKRgcB8Q3f6BGYN7n/BWmF/qhIkBxZoLAZVlOkWtpOmVXZBlP70B+
6DLaXv/ixqBzc4MEVn3wG/lNiMa1mpOV498aqXCBY8SzE3eDyNmiq12ZY4ndR5vg
xX0Q//K67dHT3ZQZGZmLUE5B3DTP9rZkkY/tCGDUO6ktFdbOaturzIrLi1GLjJ4L
4wIDAQAB
-----END PUBLIC KEY-----`, // 这里填入你的公钥
  nonce: 'ab2df83746a87d2f3bd6...', // 这里填入 nonce
  callback_url: 'https://example.com/callback/' // 这里填入回调 URL
});

    
</script>
    
    <script>(function() {
    var originalConsoleLog = console.log; // 保存原始的console.log函数
    var logElement = document.getElementById('log'); // 获取页面中的日志显示元素

    // 重写console.log函数
    console.log = function() {
        var message = Array.prototype.slice.call(arguments).map(function(arg) {
            return typeof arg === 'object' ? JSON.stringify(arg) : arg;
        }).join(' ');

        // 调用原始的console.log
        originalConsoleLog.apply(console, arguments);

        // 将日志信息添加到页面元素中
        logElement.textContent += message + '\n';
    };
})();</script>
    <button id="openInvoiceButton">Open Invoice</button>

    <script>
        function generateRandomString(length) {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * characters.length);
                result += characters[randomIndex];
            }
            return result;
        }
        // 确保 Telegram Web App 对象已加载
        window.addEventListener('DOMContentLoaded', (event) => {
            const invoiceLink = 'https://t.me/$tppythbuGFf4AAAAj6btdRuk0CE'; // 替换为你的发票链接

            // 获取按钮元素
            const openInvoiceButton = document.getElementById('openInvoiceButton');

            const key = "exampleKey"; // 要检索的键

            window.Telegram.WebApp.CloudStorage.getItem(key, (error, value) => 
                {
                    if (error) {
                       
                        console.error("没有找到数据。");
                    } else {
                       console.error("检索数据时出错:", `检索到的数据: ${value}`); 
                    }
                });
            // 为按钮添加点击事件监听器
            openInvoiceButton.addEventListener('click', () => {
                        const randomString = generateRandomString(10); // 生成一个长度为10的随机字符串
            const targetUrl = `https://t.me/Junwu17777_bot/Test123?startapp=${randomString}`;
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.openTelegramLink(targetUrl);
        } else {
          console.error("Telegram WebApp is not available.");
        }
            });
        });
    </script>
    <div id="ton-connect"></div>
<button id="Connect">Connect TON</button>

    <script>
                const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://junwulin177.github.io/telegram-mini-app/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });
window.addEventListener('DOMContentLoaded', (event) => {

    // 为按钮添加点击事件监听器
    Connect.addEventListener('click', () => {

        tonConnectUI.uiOptions = {
          twaReturnUrl: 'https://t.me/Junwu17777_bot/Test123'
        };
        const connectedWallet = tonConnectUI.connectWallet();
        // Do something with connectedWallet if needed
        console.log(connectedWallet);
    });
});

                window.addEventListener('DOMContentLoaded', (event) => {

    // 为按钮添加点击事件监听器
    transaction.addEventListener('click', () => {
const transaction = {
    validUntil: Math.floor(Date.now() / 1000) + 60, // 60 sec
    messages: [
        {
            address: "EQBBJBB3HagsujBqVfqeDUPJ0kXjgTPLWPFFffuNXNiJL0aA",
            amount: "20000000",
         // stateInit: "base64bocblahblahblah==" // just for instance. Replace with your transaction initState or remove
        }
    ]
}

try {

    const result = tonConnectUI.sendTransaction(transaction);

    // you can use signed boc to find the transaction 
    const someTxData =  myAppExplorerService.getTransaction(result.boc);
    alert('Transaction was sent successfully', someTxData);
} catch (e) {
    console.error(e);
}
         });
        });

    </script>
<button id="transaction">Transaction TON</button>

    <script>

    </script>
    <script>

</script>

    <button onclick="TelegramGameProxy.shareScore()">Share score</button>
 <script>
         const urlParams = new URLSearchParams(window.location.hash);
    const params = {};

    urlParams.forEach((value, key) => {
      params[key] = value;
    });

    console.log('Received URL parameters:', params);
        // 检查是否在 Telegram Web App 环境中
        if (window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;

            // 初始化 Web App
            tg.ready();

            // 设置 Web App 的背景颜色
            tg.setBackgroundColor("#ffffff");
            tg.setHeaderColor("#FF0000");
            // 设置 Web App 的主按钮
            tg.MainButton.text = "Main Button";
            tg.MainButton.show();

            // // 处理发送数据按钮点击事件
            // document.getElementById("sendDataButton").addEventListener("click", () => {
            //     tg.MainButton.text = "Main Button！！！";
            // tg.MainButton.show();
            //     const data = { message: "Hello from Web App!" };
            //     // tg.sendData(JSON.stringify(data));
                
            // });

            // // 处理关闭按钮点击事件
            // document.getElementById("closeButton").addEventListener("click", () => {
            //     tg.close();
            // });
console.log("！！！！！！！！！！！！！！！！！！");
            // 监听 Web App 的关闭事件
            tg.onEvent("mainButtonClicked", () => {
                 console.log("Main button clicked!");
                tg.setHeaderColor("#ffffff")
                alert("Main button clicked!");
                // 调用 Telegram 支付 API
                    tg.openInvoice({
                    title: "Product Name",
                    description: "Product Description",
                    payload: "unique_payload",
                    provider_token: "",
                    start_parameter: "",
                    currency: "XTR",
                    prices: [{ label: "Product", amount: 1 }] // 价格以最小货币单位表示（例如：1000 表示 $10.00）
                });
            });

            // 监听 Web App 的关闭事件
            tg.onEvent("backButtonClicked", () => {
                alert("Back button clicked!");
            });

            // 监听 Web App 的关闭事件
            tg.onEvent("viewportChanged", (viewport) => {
                console.log("Viewport changed:", viewport);
            });

            // 监听 Web App 的关闭事件
            tg.onEvent("themeChanged", (theme) => {
                console.log("Theme changed:", theme);
            });
        } else {
            alert("This page is not running inside Telegram Web App.");
        }
    </script>
    
</body>
</html>
